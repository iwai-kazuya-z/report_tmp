# 松本さん 1on1 アジェンダ

**日時**: 2026年1月7日（水）
**参加者**: 松本、岩井
**場所**: オンライン / オフライン

---

## 本日の相談事項

1. **PR #4079 のマージ判断**（`bootstrap.php` の変更リスク確認）
2. **MySQL 8.0化の進め方**（延長サポート費用 月13.7万円の解消）
3. **瞬断問題の対応方針**（橋本氏との役割分担）

---

## 前回（12/24）FBへの対応状況

| 指示内容 | 状況 | 次のアクション |
|---------|------|---------------|
| 開発規約・コーディングルールを直ちに作成 | ✅ 完了 | - |
| テストファースト徹底 | 🔄 基盤復旧まで完了 | CI必須化（1月中） |
| 瞬断問題の修正 | 🔄 原因特定済 | 橋本氏と連携して修正 |
| DB統合を橋本氏リードで | 🔄 役割分担確定 | MySQL 8.0化を先行 |

---

## dorapitaプロジェクト 全体状況

### 現在の課題マップ

```
┌─────────────────────────────────────────────────────────────────────┐
│                     dorapita プロジェクト課題                        │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  【緊急度: 高】                    【緊急度: 中】                     │
│  ┌─────────────────────┐          ┌─────────────────────┐          │
│  │ 瞬断問題            │          │ MySQL 8.0化         │          │
│  │ ・週10-20回発生     │          │ ・延長サポート       │          │
│  │ ・原因: 同期バッチ   │    ───→  │   月13.7万円        │          │
│  │ ・N+1問題特定済     │          │ ・年164万円削減     │          │
│  └─────────────────────┘          └─────────────────────┘          │
│           │                                │                       │
│           ▼                                ▼                       │
│  ┌─────────────────────────────────────────────────────┐          │
│  │              DB統合（PostgreSQL → MySQL）            │          │
│  │              橋本氏リード / 岩井インフラ支援          │          │
│  └─────────────────────────────────────────────────────┘          │
│                                                                     │
│  【基盤整備】                      【コスト最適化】                   │
│  ┌─────────────────────┐          ┌─────────────────────┐          │
│  │ AI駆動開発基盤      │          │ STG環境最適化       │          │
│  │ ・DevContainer ✅   │          │ ・夜間停止          │          │
│  │ ・テスト基盤 ✅     │          │ ・Cloud SQL再作成   │          │
│  │ ・CI必須化 🔜       │          │ ・年100万円削減     │          │
│  └─────────────────────┘          └─────────────────────┘          │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 開発体制

```
┌─────────────────────────────────────────────────────────────────────┐
│                        開発体制 & 役割分担                           │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   ┌───────────┐                                                    │
│   │  松本さん  │  技術方針・レビュー・意思決定                       │
│   └─────┬─────┘                                                    │
│         │                                                          │
│   ┌─────┴─────────────────────────────────┐                        │
│   │                                       │                        │
│   ▼                                       ▼                        │
│ ┌───────────┐                      ┌───────────┐                   │
│ │  橋本氏   │                      │   岩井    │                   │
│ │           │                      │           │                   │
│ │ ・アプリ改修                      │ ・インフラ整備                 │
│ │ ・DB統合リード                    │ ・コスト管理                   │
│ │ ・コード品質                      │ ・監視・障害対応               │
│ └───────────┘                      └───────────┘                   │
│         │                                 │                        │
│         └────────────┬────────────────────┘                        │
│                      ▼                                             │
│              ┌───────────────┐                                     │
│              │   VNチーム    │                                     │
│              │  （実装担当）  │                                     │
│              │  ※稼働率低下中 │                                     │
│              └───────────────┘                                     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 相談1: PR #4079 マージ判断

### 変更概要

| 項目 | 内容 |
|------|------|
| **PR** | #4079（+8,566行）、#4070（+3,165行） |
| **目的** | AI駆動開発の基盤整備 |
| **主な変更** | DevContainer、テスト基盤、開発規約 |

### リスク確認したい点

```
bootstrap.php の変更
─────────────────────────────────────────
Before: 環境判定が暗黙的（ホスト名ベース）
After:  APP_ENV 環境変数で明示的に分離

懸念: 本番環境で APP_ENV 未設定だと動作に影響？
      → 既存の分岐ロジックはフォールバックとして残存
```

**お願い**: 変更内容を確認いただき、マージ可否の判断をお願いしたい

---

## 相談2: MySQL 8.0化の進め方

### 背景

```
現状: MySQL 5.7（2023年10月 EOL）
      └→ 延長サポート費用: 月13.7万円（年164万円）

対応: MySQL 8.0 へアップグレード
      └→ 延長サポート費用が不要に
```

### 提案する進め方

```
Phase 1: STGでアップグレード検証
         └→ アプリ互換性確認（VNチームと連携）

Phase 2: 本番適用（メンテナンス時間を設定）
         └→ 1-2月で完了目標
```

**相談**: この進め方で問題ないか？他に考慮すべき点は？

---

## 相談3: 瞬断問題の対応方針

### 現状

```
発生頻度: 週10-20回
原因:     同期バッチ（MySQL → PostgreSQL）
          ├─ N+1問題
          └─ トランザクション都度実行
```

### 対応オプション

| オプション | 内容 | メリット | デメリット |
|-----------|------|---------|-----------|
| **A. バッチ修正** | N+1解消、バルク処理化 | 短期で効果 | 根本解決ではない |
| **B. DB統合優先** | PostgreSQL廃止を急ぐ | 根本解決 | 時間がかかる |
| **C. 併用** | Aで応急処置しつつBを進行 | バランス | 工数分散 |

**相談**: どのオプションで進めるべきか？

---

## 共有: VNチームの稼働状況

```
コミット数推移（月平均）
────────────────────────────────────────
Q1 (1-3月):  700/月  ████████████████████
Q2 (4-6月):  609/月  ████████████████
Q3 (7-9月):  534/月  ██████████████
Q4 (10-12月): 402/月  ██████████
                      ↓
                    -43% 減少
```

*   主力開発者（Lan Le）の活動量が -79%
*   Tech Lead（Huy Nguyen）がほぼ不活性

**共有のみ**: 必要であればVentura社に状況確認を検討

---

## 次回アクション（案）

| 項目 | 担当 | 期限 |
|------|------|------|
| PR #4079 マージ | 松本さん判断 | 今週 |
| MySQL 8.0 STG検証開始 | 岩井 + VN | 1月中旬 |
| 瞬断対応方針決定 | 本日決定 | - |
| テスト規約（TESTING_RULES.md）策定 | 岩井 | 1月中 |
