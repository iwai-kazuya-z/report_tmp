# ãƒ‰ãƒ©ãƒ”ã‚¿ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹é€ 

ãƒ‰ãƒ©ãƒ”ã‚¿ã¯è¤‡æ•°ã®ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³/ã‚µãƒ¼ãƒ“ã‚¹ã§æ§‹æˆã•ã‚Œã‚‹ãƒ¢ãƒãƒªãƒã‚¸ãƒˆãƒªå‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¸€è¦§

| ã‚µãƒ¼ãƒ“ã‚¹å | å½¹å‰² | ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | DB | é–‹ç™ºãƒãƒ¼ãƒˆ | GCP Cloud Run |
|------------|------|---------------|----|-----------:|---------------|
| **dorapita.com** | ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ãƒˆï¼ˆæ±‚äººæ¤œç´¢ï¼‰ | CakePHP 4.4 | PostgreSQL | 8080 | âœ… é–‹ç™ºç’°å¢ƒã®ã¿ |
| **cadm.dorapita.com** | é¡§å®¢ç®¡ç†ç”»é¢ | CakePHP 4.5 | PostgreSQL | 8888 | âœ… é–‹ç™ºç’°å¢ƒã®ã¿ |
| **edit.dorapita.com** | æ±‚äººæƒ…å ±ç·¨é›† | CakePHP 4.x | PostgreSQL | 9090 | âœ… é–‹ç™ºç’°å¢ƒã®ã¿ |
| **img.dorapita.com** | ç”»åƒé…ä¿¡ | - | - | 9090 | âœ… æœ¬ç•ªãƒ»é–‹ç™ºä¸¡æ–¹ |
| **help.dorapita.com** | ãƒ˜ãƒ«ãƒ—ã‚µã‚¤ãƒˆ | - | - | - | âœ… æœ¬ç•ªãƒ»é–‹ç™ºä¸¡æ–¹ |
| **kanri.dorapita.com** | ç®¡ç†ç”»é¢ | CakePHP 4.x | MySQL | 8088 | âŒ VMé…å‚™ã®ã¿ |
| **legacy.dorapita.com** | æ—§ã‚·ã‚¹ãƒ†ãƒ  | CakePHP 1.3.21 (PHP 5.6) | MySQL | - | âŒ éç¨¼åƒ |
| **dora-pt.jp** | åˆ¥ãƒ‰ãƒ¡ã‚¤ãƒ³ | CakePHP 4.x | - | 9999 | âŒ |
| **api-dorapita-com** | APIï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰ | CakePHP 5.2 (ã‚¹ã‚±ãƒ«ãƒˆãƒ³) | - | - | âœ… é–‹ç™ºç’°å¢ƒã®ã¿ |
| **dorapita-maintenance** | ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒšãƒ¼ã‚¸ | é™çš„ | - | - | âœ… æœ¬ç•ªãƒ»é–‹ç™ºä¸¡æ–¹ |

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cloud Load Balancer + Cloud Armor            â”‚
â”‚                         (WAF, SSLçµ‚ç«¯)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                â”‚
     â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloud Run â”‚    â”‚ Compute Engineâ”‚
â”‚ (é–‹ç™ºã®ã¿) â”‚    â”‚   (æœ¬ç•ªVM)    â”‚
â”‚          â”‚    â”‚               â”‚
â”‚ - dorapitaâ”‚    â”‚ - web-*      â”‚
â”‚ - cadm   â”‚    â”‚ - kanri-*    â”‚
â”‚ - edit   â”‚    â”‚               â”‚
â”‚ - img    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - help   â”‚            â”‚
â”‚ - api    â”‚            â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚
      â”‚                 â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                    â”‚
     â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Cloud SQL â”‚      â”‚ Filestore  â”‚
â”‚MySQL 5.7 â”‚      â”‚   (NFS)    â”‚
â”‚PostgreSQLâ”‚      â”‚            â”‚
â”‚   10     â”‚      â”‚ /mnt å…±æœ‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Memorystore â”‚
â”‚   (Redis)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|----------|------|
| PHP | 8.1 (ãƒ¡ã‚¤ãƒ³), 5.6 (legacy) | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ |
| CakePHP | 4.4, 4.5 (ãƒ¡ã‚¤ãƒ³), 1.3.21 (legacy), 5.2 (API) | ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

| DB | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|----|----------|------|
| PostgreSQL | 10 | dorapita.com, cadm, edit ã®ä¸»DB |
| MySQL | 5.7 | kanri, legacy ã®ä¸»DB |
| Redis | - | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ |

### ã‚¤ãƒ³ãƒ•ãƒ©

| æŠ€è¡“ | ç”¨é€” |
|------|------|
| Docker | ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ |
| Cloud Run | é–‹ç™ºç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ (dorapita, cadm, edit, api) |
| Compute Engine | æœ¬ç•ªç’°å¢ƒVM (kanriå«ã‚€) |
| Cloud SQL | ãƒãƒãƒ¼ã‚¸ãƒ‰DB (MySQL, PostgreSQL) |
| Filestore | NFSå…±æœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ (ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«) |
| Cloud Load Balancer | SSLçµ‚ç«¯ãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° |
| Cloud Armor | WAF (DDoSå¯¾ç­–ã€IPåˆ¶é™) |

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
dorapita_code/
â”œâ”€â”€ dorapita.com/              # ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ãƒˆ (69 controllers)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ Controller/
â”‚   â”‚   â”œâ”€â”€ Model/
â”‚   â”‚   â””â”€â”€ View/
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ templates/
â”‚   â””â”€â”€ composer.json          # CakePHP 4.4
â”‚
â”œâ”€â”€ cadm.dorapita.com/         # é¡§å®¢ç®¡ç†ç”»é¢ (45 controllers)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ Controller/
â”‚   â”‚   â”œâ”€â”€ Model/
â”‚   â”‚   â””â”€â”€ View/
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ templates/
â”‚   â””â”€â”€ composer.json          # CakePHP 4.5
â”‚
â”œâ”€â”€ edit.dorapita.com/         # æ±‚äººç·¨é›†
â”œâ”€â”€ img.dorapita.com/          # ç”»åƒé…ä¿¡
â”œâ”€â”€ help.dorapita.com/         # ãƒ˜ãƒ«ãƒ—
â”œâ”€â”€ kanri.dorapita.com/        # ç®¡ç†ç”»é¢
â”œâ”€â”€ legacy.dorapita.com/       # æ—§ã‚·ã‚¹ãƒ†ãƒ  (CakePHP 1.3.21)
â”œâ”€â”€ dora-pt.jp/                # åˆ¥ãƒ‰ãƒ¡ã‚¤ãƒ³
â”œâ”€â”€ now_on_maintenance/        # ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒšãƒ¼ã‚¸
â”‚
â”œâ”€â”€ docker-compose.yml         # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ
â”œâ”€â”€ Dockerfile*                # å„ã‚µãƒ¼ãƒ“ã‚¹ç”¨Dockerfile
â””â”€â”€ README.md
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹æˆ

### PostgreSQL (ä¸»è¦)
- **Database**: `dorapita`
- **User**: `dorauser2022`
- **ç”¨é€”**: dorapita.com, cadm.dorapita.com, edit.dorapita.com

### MySQL (å‰¯æ¬¡)
- **Database**: `dorapita1804`
- **ç”¨é€”**: kanri.dorapita.com, legacy.dorapita.com

## ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

### èµ·å‹•æ–¹æ³•

```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
cp dorapita.com/config/.env.example dorapita.com/config/.env

# Docker Composeèµ·å‹•
docker compose build
docker compose up
```

### ã‚¢ã‚¯ã‚»ã‚¹URL

| ã‚µãƒ¼ãƒ“ã‚¹ | ãƒ­ãƒ¼ã‚«ãƒ«URL |
|---------|------------|
| dorapita.com | http://localhost:8080 |
| cadm.dorapita.com | http://localhost:8888 |
| edit.dorapita.com | http://localhost:9090 |
| img.dorapita.com | http://localhost:9090 |
| kanri.dorapita.com | http://localhost:8088 |
| dora-pt.jp | http://localhost:9999 |
| MailHog | http://localhost:8025 |

## GCPç’°å¢ƒå·®ç•°

### æœ¬ç•ªç’°å¢ƒ (dorapita-core)
- **VMä¸­å¿ƒ**: Compute Engineä¸Šã§å‹•ä½œ
- **ä¸»è¦ã‚µãƒ¼ãƒ“ã‚¹**: web-*, kanri-*
- **Cloud Run**: img, help, maintenanceã®ã¿

### é–‹ç™ºç’°å¢ƒ (dorapita-core-dev)
- **Cloud Runä¸­å¿ƒ**: å¤šãã®ã‚µãƒ¼ãƒ“ã‚¹ãŒCloud Runã§å‹•ä½œ
- **è¿½åŠ ã‚µãƒ¼ãƒ“ã‚¹**: api-dorapita-com (ãƒ†ã‚¹ãƒˆç”¨APIã‚¹ã‚±ãƒ«ãƒˆãƒ³)
- **VM**: ä¸€éƒ¨åœæ­¢ä¸­ (pg-120010, web-120012ç­‰)

## ä¸»è¦ãªèª²é¡Œãƒ»æ³¨æ„ç‚¹

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹EOL**: MySQL 5.7, PostgreSQL 10 ã¯å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆEOLæ¸ˆã¿ï¼‰
2. **CakePHPæ··åœ¨**: 4.4, 4.5, 5.2 ãŒæ··åœ¨ã€‚1.3.21 (legacy) ã‚‚æ®‹å­˜
3. **ãƒ¢ãƒãƒªãƒç®¡ç†**: è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ãŒ1ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªã«æ··åœ¨
4. **é–‹ç™ºãƒ»æœ¬ç•ªã®å·®ç•°**: ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆãŒå¤§ããç•°ãªã‚‹ï¼ˆVM vs Cloud Runï¼‰
5. **APIæœªå®Ÿè£…**: api-dorapita-com ã¯ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã®ã¿ã§å®Ÿè£…ãªã—

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆ

### As-Is: ç¾çŠ¶ã®é–‹ç™ºç’°å¢ƒ ğŸ“Š
- [**ç¾çŠ¶åˆ†æã‚µãƒãƒªãƒ¼**](as-is/) - ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒãƒ»DBåˆ†æ
  - [ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ](as-is/local-development.md) - Docker Composeç’°å¢ƒ
  - [é–‹ç™ºã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](as-is/local-development-architecture.md) - ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³
  - [DBåˆ†æãƒ¬ãƒãƒ¼ãƒˆ](as-is/database-analysis/) - ãƒ†ãƒ¼ãƒ–ãƒ«åˆ†æãƒ»æœªä½¿ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«

### To-Be: æ”¹å–„æˆ¦ç•¥ ğŸš€
- [**æ”¹å–„æˆ¦ç•¥ã‚µãƒãƒªãƒ¼**](to-be/) - DevContainerãƒ»Fixtureæˆ¦ç•¥
  - [DevContainerç§»è¡Œè¨ˆç”»](to-be/devcontainer-setup.md) - é–‹ç™ºç’°å¢ƒæ¨™æº–åŒ–
  - [Fixtureæˆ¦ç•¥](to-be/fixture-strategy.md) - ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æ•´å‚™
  - **å‰Šæ¸›åŠ¹æœ**: å¹´é–“ç´„1,064ä¸‡å††

### é‡è¦èª²é¡Œãƒ¬ãƒãƒ¼ãƒˆ âš ï¸
- [**é‡è¦èª²é¡Œã‚µãƒãƒªãƒ¼**](important_issues/) - ã‚³ã‚¹ãƒˆå‰Šæ¸›ãƒ»DBçµ±åˆãƒ»ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
  - [ã‚µãƒ¼ãƒãƒ¼ã‚³ã‚¹ãƒˆå‰Šæ¸›ãƒ¬ãƒãƒ¼ãƒˆ](important_issues/SERVER_COST_REDUCTION_REPORT.md) - å¹´é–“296ã€œ392ä¸‡å††å‰Šæ¸›å¯èƒ½æ€§
  - [DBäºŒé‡ç®¡ç†ãƒªã‚¹ã‚¯ãƒ¬ãƒãƒ¼ãƒˆ](important_issues/DB_INTEGRATION_TECHNICAL_RISK_REPORT.md) - ç¬æ–­ãƒ»ä¿å®ˆã‚³ã‚¹ãƒˆå•é¡Œ
  - [BOTå¯¾ç­–ãƒ»ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°](important_issues/BOT_ACCESS_AUTOSCALING_REPORT.md) - è² è·åˆ†æ•£æˆ¦ç•¥

### ãƒ„ãƒ¼ãƒ« ğŸ› ï¸
- [**é–‹ç™ºæ”¯æ´ãƒ„ãƒ¼ãƒ«**](tools/) - DBåˆ†æãƒ»Fixtureç”Ÿæˆ
  - [ãƒ†ãƒ¼ãƒ–ãƒ«åˆ†æã‚¹ã‚¯ãƒªãƒ—ãƒˆ](tools/analyze-table-usage.sh)

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### GCPã‚¤ãƒ³ãƒ•ãƒ©
- [GCPã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæ¦‚è¦](../gcp_inventory_reports/dorapita-inventory.md)
- [é–‹ç™ºç’°å¢ƒè©³ç´°](../gcp_inventory_reports/dorapita-core-dev-inventory.md)
- [æœ¬ç•ªç’°å¢ƒè©³ç´°](../gcp_inventory_reports/dorapita-core-inventory.md)
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»](../gcp_inventory_reports/dorapita-security-audit.md)

### æˆ¦ç•¥ãƒ»çµ„ç¹”
- [çµ„ç¹”å¤‰é©æˆ¦ç•¥](../strategy/dorapita-org-transformation-strategy.md) - RACIã€Phaseè¨ˆç”»
- [Venturaç¤¾ï¼ˆVNã‚ªãƒ•ã‚·ãƒ§ã‚¢ï¼‰åˆ†æ](../strategy/ventura/) - å¹´é–“æ´»å‹•ãƒ»ã‚³ã‚¹ãƒˆåˆ†æ
